local player = game.Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")
local starterGui = game:GetService("StarterGui")

-- Function to collect hierarchy of any object
local function collectHierarchy(parent, path)
	local currentPath = path and (path .. " > " .. parent.Name) or parent.Name
	local itemList = {}

	for _, child in ipairs(parent:GetChildren()) do
		table.insert(itemList, currentPath .. " > " .. child.Name)
		local childItemList = collectHierarchy(child, currentPath)
		for _, subChild in ipairs(childItemList) do
			table.insert(itemList, subChild)
		end
	end

	return itemList
end

-- Function to display collected hierarchy in a scrolling frame
local function displayHierarchy(itemList)
	-- Create a ScreenGui in PlayerGui to display the hierarchy
	local displayGui = Instance.new("ScreenGui")
	displayGui.Name = "HierarchyDisplay"
	displayGui.ResetOnSpawn = false
	displayGui.Parent = playerGui  -- Make it visible to the player

	-- Create a ScrollingFrame with the specified position and size
	local scrollingFrame = Instance.new("ScrollingFrame")
	scrollingFrame.Size = UDim2.new(0, 361, 0, 268)
	scrollingFrame.Position = UDim2.new(0.311, 0, 0.239, 0)
	scrollingFrame.BackgroundTransparency = 0.3
	scrollingFrame.BackgroundColor3 = Color3.new(0, 0, 0)
	scrollingFrame.ScrollBarThickness = 12
	scrollingFrame.CanvasSize = UDim2.new(0, 0, 0, 0)  -- Initialize CanvasSize
	scrollingFrame.Parent = displayGui

	-- Create a UIListLayout for automatically positioning TextLabels
	local uiListLayout = Instance.new("UIListLayout")
	uiListLayout.Parent = scrollingFrame
	uiListLayout.SortOrder = Enum.SortOrder.LayoutOrder
	uiListLayout.Padding = UDim.new(0, 2)

	-- Create a frame to hold the text labels
	local textFrame = Instance.new("Frame")
	textFrame.Size = UDim2.new(1, 0, 1, 0)
	textFrame.BackgroundTransparency = 1
	textFrame.Parent = scrollingFrame

	-- Add a TextLabel for each item in the list
	for i, item in ipairs(itemList) do
		local textLabel = Instance.new("TextLabel")
		textLabel.Size = UDim2.new(1, 0, 0, 30)  -- Fixed height for each item
		textLabel.Position = UDim2.new(0, 0, 0, (i - 1) * 32)  -- Space items vertically
		textLabel.Text = item
		textLabel.TextScaled = true
		textLabel.BackgroundTransparency = 1  
		textLabel.TextColor3 = Color3.new(1, 1, 1)
		textLabel.TextXAlignment = Enum.TextXAlignment.Left
		textLabel.Parent = textFrame
	end

	-- Adjust ScrollingFrame's CanvasSize to fit all content
	scrollingFrame.CanvasSize = UDim2.new(0, 0, 0, #itemList * 32)
end

-- Function to collect player-specific information, including everything under the player
local function collectPlayerInfo()
	local playerInfoList = {}

	-- Collect hierarchy from all descendants of the player
	local playerHierarchy = collectHierarchy(player, "Player")
	for _, element in ipairs(playerHierarchy) do
		table.insert(playerInfoList, element)
	end

	return playerInfoList
end

-- Function to collect information from StarterGui and Player, and then display it
local function checkAndDisplay()
	-- Collect UI hierarchy from StarterGui
	local starterGuiHierarchy = collectHierarchy(starterGui, "StarterGui")

	-- Collect player information and hierarchy from all descendants
	local playerInfo = collectPlayerInfo()

	-- Combine both info
	local combinedInfo = {}
	for _, info in ipairs(starterGuiHierarchy) do
		table.insert(combinedInfo, info)
		table.insert(combinedInfo, " ") -- Adding space for readability
		table.insert(combinedInfo, " ")
	end
	for _, info in ipairs(playerInfo) do
		table.insert(combinedInfo, info)
	end

	-- Display the combined hierarchy and player info
	displayHierarchy(combinedInfo)
end

wait(5)

-- Collect and display all necessary information
checkAndDisplay()
	
